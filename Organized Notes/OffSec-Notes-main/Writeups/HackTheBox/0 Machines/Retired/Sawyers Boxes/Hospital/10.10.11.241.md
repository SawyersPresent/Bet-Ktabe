---
Date: 2024-04-14
Platform: Linux & windows
Difficulty: Medium
Status: Retired
IP: 10.10.11.241
---








---



- Open ports
	- SSH
		- Ubuntu
	- SMB
	- Kerberos
	- LDAP
		- Windows DC (?) 
	- Apache
		- port 8080 too 
	- Webmail
		- Port 443

# Enumeration 

## nmap 

```
kali@kali ~> cat hospital.htb
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-14 15:02 EDT
Nmap scan report for hospital.htb (10.10.11.241)
Host is up (0.10s latency).
Not shown: 980 filtered tcp ports (no-response)
PORT     STATE SERVICE           VERSION
22/tcp   open  ssh               OpenSSH 9.0p1 Ubuntu 1ubuntu8.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   256 e1:4b:4b:3a:6d:18:66:69:39:f7:aa:74:b3:16:0a:aa (ECDSA)
|_  256 96:c1:dc:d8:97:20:95:e7:01:5f:20:a2:43:61:cb:ca (ED25519)
53/tcp   open  domain            Simple DNS Plus
88/tcp   open  kerberos-sec      Microsoft Windows Kerberos (server time: 2024-04-15 02:03:03Z)
135/tcp  open  msrpc             Microsoft Windows RPC
139/tcp  open  netbios-ssn       Microsoft Windows netbios-ssn
389/tcp  open  ldap              Microsoft Windows Active Directory LDAP (Domain: hospital.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC
| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb
| Not valid before: 2023-09-06T10:49:03
|_Not valid after:  2028-09-06T10:49:03
443/tcp  open  ssl/http          Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.0.28)
|_http-title: Hospital Webmail :: Welcome to Hospital Webmail
|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.0.28
|_ssl-date: TLS randomness does not represent time
| tls-alpn:
|_  http/1.1
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2009-11-10T23:48:47
|_Not valid after:  2019-11-08T23:48:47
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http        Microsoft Windows RPC over HTTP 1.0
636/tcp  open  ldapssl?
| ssl-cert: Subject: commonName=DC
| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb
| Not valid before: 2023-09-06T10:49:03
|_Not valid after:  2028-09-06T10:49:03
1801/tcp open  msmq?
2103/tcp open  msrpc             Microsoft Windows RPC
2105/tcp open  msrpc             Microsoft Windows RPC
2107/tcp open  msrpc             Microsoft Windows RPC
2179/tcp open  vmrdp?
3268/tcp open  ldap              Microsoft Windows Active Directory LDAP (Domain: hospital.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=DC
| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb
| Not valid before: 2023-09-06T10:49:03
|_Not valid after:  2028-09-06T10:49:03
3269/tcp open  globalcatLDAPssl?
| ssl-cert: Subject: commonName=DC
| Subject Alternative Name: DNS:DC, DNS:DC.hospital.htb
| Not valid before: 2023-09-06T10:49:03
|_Not valid after:  2028-09-06T10:49:03
3389/tcp open  ms-wbt-server     Microsoft Terminal Services
| ssl-cert: Subject: commonName=DC.hospital.htb
| Not valid before: 2024-04-13T17:46:01
|_Not valid after:  2024-10-13T17:46:01
| rdp-ntlm-info:
|   Target_Name: HOSPITAL
|   NetBIOS_Domain_Name: HOSPITAL
|   NetBIOS_Computer_Name: DC
|   DNS_Domain_Name: hospital.htb
|   DNS_Computer_Name: DC.hospital.htb
|   DNS_Tree_Name: hospital.htb
|   Product_Version: 10.0.17763
|_  System_Time: 2024-04-15T02:03:54+00:00
8080/tcp open  http              Apache httpd 2.4.55 ((Ubuntu))
| http-title: Login
|_Requested resource was login.php
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-open-proxy: Proxy might be redirecting requests
|_http-server-header: Apache/2.4.55 (Ubuntu)
Service Info: Host: DC; OSs: Linux, Windows; CPE: cpe:/o:linux:linux_kernel, cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   date: 2024-04-15T02:03:56
|_  start_date: N/A
|_clock-skew: mean: 6h59m55s, deviation: 0s, median: 6h59m55s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 104.19 seconds
```



so its windows and linux, kind of suspicious.


To setup listener:
```
kali@kali ~> sudo tcpdump -i tun0 -v -n ip src 10.10.11.241
tcpdump: listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
```

- `-i`
	- Interface
- `-v`
	- Verbose
- `-n`
	- Disable DNS
- `ip`
	- Allows me to see incoming and outbound connections with anything related to this IP
- `src`
	- Filters out the connections so that it only looks for connections coming to me


Lets do a normal ping and see the response


```
kali@kali ~> ping 10.10.11.241
PING 10.10.11.241 (10.10.11.241) 56(84) bytes of data.
64 bytes from 10.10.11.241: icmp_seq=1 ttl=127 time=100 ms
64 bytes from 10.10.11.241: icmp_seq=2 ttl=127 time=100 ms
```

```
kali@kali ~> sudo tcpdump -i tun0 -v -n ip src 10.10.11.241
tcpdump: listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
15:42:10.848667 IP (tos 0x0, ttl 127, id 22444, offset 0, flags [none], proto ICMP (1), length 84)
    10.10.11.241 > 10.10.14.9: ICMP echo reply, id 3645, seq 1, length 64
15:42:11.849092 IP (tos 0x0, ttl 127, id 22445, offset 0, flags [none], proto ICMP (1), length 84)
    10.10.11.241 > 10.10.14.9: ICMP echo reply, id 3645, seq 2, length 64

```


Now lets set a trigger for the SSH

```
kali@kali ~> nc -zv 10.10.11.241 22
hospital.htb [10.10.11.241] 22 (ssh) open
```


```
kali@kali ~> sudo tcpdump -i tun0 -v -n ip src 10.10.11.241
tcpdump: listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes
15:30:06.596623 IP (tos 0x0, ttl 62, id 0, offset 0, flags [DF], proto TCP (6), length 60)
    10.10.11.241.22 > 10.10.14.9.60566: Flags [S.], cksum 0x61ff (correct), seq 4121582384, ack 4039095304, win 65160, options [mss 1340,sackOK,TS val 3777999140 ecr 2884933944,nop,wscale 7], length 0
15:30:06.714480 IP (tos 0x0, ttl 62, id 262, offset 0, flags [DF], proto TCP (6), length 52)
    10.10.11.241.22 > 10.10.14.9.60566: Flags [.], cksum 0x8c0b (correct), ack 2, win 510, options [nop,nop,TS val 3777999248 ecr 2884934046], length 0
15:30:06.721363 IP (tos 0x0, ttl 62, id 263, offset 0, flags [DF], proto TCP (6), length 93)
    10.10.11.241.22 > 10.10.14.9.60566: Flags [P.], cksum 0x5fa7 (correct), seq 1:42, ack 2, win 510, options [nop,nop,TS val 3777999262 ecr 2884934046], length 41: SSH: SSH-2.0-OpenSSH_9.0p1 Ubuntu-1ubuntu8.5
15:30:06.721404 IP (tos 0x0, ttl 62, id 264, offset 0, flags [DF], proto TCP (6), length 52)
    10.10.11.241.22 > 10.10.14.9.60566: Flags [F.], cksum 0x8bd2 (correct), seq 42, ack 2, win 510, options [nop,nop,TS val 3777999263 ecr 2884934046], length 0

```




- TTL
	- On windows
		- 128 TTL default
			- Our scan gave us 127
			- It decks a point every time it hits a router
	- On linux
		- 64 TTL default
			- our scan gave us 62 TTL
			- This could very well mean that there are 2 hops
				- one through whatever container and the other through the router (in this case its the VPN)
				- In this case its hyperV, the reason is for this is because if its docker it wouldn't deck down the TTL




## Directory search


```
kali@kali ~> feroxbuster -u http://10.10.11.241:8080/

 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ðŸ¤“                 ver: 2.10.2
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ðŸŽ¯  Target Url            â”‚ http://10.10.11.241:8080/
 ðŸš€  Threads               â”‚ 50
 ðŸ“–  Wordlist              â”‚ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 ðŸ‘Œ  Status Codes          â”‚ All Status Codes!
 ðŸ’¥  Timeout (secs)        â”‚ 7
 ðŸ¦¡  User-Agent            â”‚ feroxbuster/2.10.2
 ðŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ðŸ”Ž  Extract Links         â”‚ true
 ðŸ  HTTP methods          â”‚ [GET]
 ðŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ðŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        9l       28w      320c http://10.10.11.241:8080/images => http://10.10.11.241:8080/images/
302      GET        0l        0w        0c http://10.10.11.241:8080/ => login.php
301      GET        9l       28w      317c http://10.10.11.241:8080/css => http://10.10.11.241:8080/css/
301      GET        9l       28w      321c http://10.10.11.241:8080/uploads => http://10.10.11.241:8080/uploads/
301      GET        9l       28w      319c http://10.10.11.241:8080/fonts => http://10.10.11.241:8080/fonts/
301      GET        9l       28w      316c http://10.10.11.241:8080/js => http://10.10.11.241:8080/js/
301      GET        9l       28w      326c http://10.10.11.241:8080/images/icons => http://10.10.11.241:8080/images/icons/
301      GET        9l       28w      320c http://10.10.11.241:8080/vendor => http://10.10.11.241:8080/vendor/

```



obviously we head to the port `8080` and we see that there's a user we need to make and then we have an `upload` page so lets upload a php file and basically use intruder ANDDD feroxbuster to test this


```
POST /upload.php HTTP/1.1
Host: 10.10.11.241:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: http://10.10.11.241:8080/index.php
Content-Type: multipart/form-data; boundary=---------------------------389512310042468231712911540042
Content-Length: 122208
Origin: http://10.10.11.241:8080
Connection: close
Cookie: PHPSESSID=devsqgffvn7ioc7sm46qa1sp0e
Upgrade-Insecure-Requests: 1

-----------------------------389512310042468231712911540042

Content-Disposition: form-data; name="image"; filename="dawgass.jpg"
Content-Type: image/jpeg


Ã¿Ã˜Ã¿Ã 
```

So lets send this to intruder and filter out the possible extensions