[VirtualBox](https://www.virtualbox.org/wiki/Downloads)
[Whonix](https://www.whonix.org/wiki/VirtualBox)
[Kali Linux](https://www.kali.org/get-kali/#kali-platforms)

`TOR only accepts TCP connections if the VPN server has been configured`
	
```bash
watch -n 3 "curl -s ip.me"
```

---
#### VirtualBox - Whonix - Kali
#### Gateway
- Connect to TOR

Updating the system
```bash
upgrade-nonroot
```

```bash
sudo apt-get-update-plus dist-upgrade
```

Testing to make sure
```bash
systemcheck

anon-verify
```

---
#### Kali-Whonix
##### In VirtualBox
- **Settings**
- Change **NAT** to **Internal Network**
##### In Kali (if prebuilt)
- **Advanced Network Configuration**
- Edit the **Wired connection1**
- Go to IPv4 Settings, choose manual and enter the following details from this table below
	
|Address|Netmask|Gateway|DNS servers|
|---|---|---|---|
|10.152.152.2-254|255.255.192.0|10.152.152.10|10.152.152.10|

if needed, edit this `50_user.conf` here to use a static tor-node
```bash
sudo nano /usr/local/etc/torrc.d/50_user.conf
```
	
```bash
ExitNodes <static_exit_node_IP>

StrictNodes 1

TrackHostExits shodan.io
```
	keep finding a new tor circuit that works

![[Pasted image 20231215210424.png]]

Testing to make sure
```bash
curl --silent https://check.torproject.org | grep -m 1 "Congratulations. This browser is configured to use Tor."
```
#### Proxychains
```bash
sudo nano /etc/proxychains4.conf
```
	dynamic chain
	socks5 	127.0.0.1 9050

---
#### After Do

Update
```bash
sudo apt update && sudo apt upgrade -y && sudo apt dist-upgrade -y && apt --fix-broken install -y && apt --fix-missing install -y && sudo apt autoremove -y && sudo apt clean -y
```

Changing SSH keys
```bash
cd /etc/ssh/

sudo mkdir default_kali_keys

sudo mv ssh_host_* default_kali_keys/

sudo dpkg-reconfigure openssh-server

sudo md5sum ssh_host_*

echo "-------------------------------------------"

cd default_kali_keys/ && sudo md5sum ssh_host_*

cd ..

sudo rm -rf default_kali_keys

exit
```

Tor-Browser
```bash
sudo apt install -y tor torbrowser-launcher
```
	
```bash
sudo apt install tor -y

sudo systemctl start tor

sudo systemctl enable tor

sudo systemctl status tor
```

Terminal
```bash
sudo apt-get install guake -y

sudo cp /usr/share/applications/guake.desktop /etc/xdg/autostart/

sudo reboot now
```

---
#### Kali Network Obfuscation

Host-name
```bash
sudo hostnamectl set-hostname DESKTOP-HNA2AEVS
sudo sed -i "s/127.0.1.1.*/127.0.1.1\tDESKTOP-HNA2AEVS/" /etc/hosts
```
	
```bash
sudo sed -i '/\[ipv4\]/a dhcp-send-hostname=false' /etc/NetworkManager/system-connections/Wired\ connection\ 1
```

NTP
```bash
sudo systemctl stop systemd-timesync
```

Netfilter
```bash
sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
sudo iptables -t mangle -A PREROUTING -m conntrack --ctstate INVALID -j DROP
sudo iptables -A INPUT -p icmp --icmp-type 0 -m conntrack --ctstate NEW -j ACCEPT
sudo iptables -A INPUT -p icmp --icmp-type 3 -m conntrack --ctstate NEW -j ACCEPT
sudo iptables -A INPUT -p icmp --icmp-type 11 -m conntrack --ctstate NEW -j ACCEPT
sudo iptables -A INPUT -p icmp -j DROP
sudo iptables -t mangle -A PREROUTING -p tcp -m conntrack --ctstate NEW -m tcpmss ! --mss 536:65535 -j DROP
```

Disable ICMP Redirect
```bash
sudo sysctl -w net.ipv4.conf.all.accept_redirects=0
sudo sysctl -w net.ipv6.conf.all.accept_redirects=0
```

Mac-Address Randomization.
`Configure NetworkManager to change the MAC address to a random one each time you connect to the network.`
```bash
echo -e "\n[connection]\nwifi.cloned-mac-address=random\n\n[connection]\nethernet.cloned-mac-address=random" | sudo tee -a /etc/NetworkManager/NetworkManager.conf
```

TTL
```bash
sudo sysctl -w net.ipv4.ip_default_ttl=128
```

```bash
sudo iptables -t mangle -A PREROUTING -i eth0 -j TTL --ttl-inc 1
```

- Turn off sleep

---
#### Linux Persistence
	
```bash
sudo passwd root

su root

fdisk -l

cryptsetup --verbose --verify-passphrase luksFormat /dev/<sdb>

cryptsetup luksOpen /dev/<sdb> pers

mkfs.ext3 /dev/mapper/pers

e2label /dev/mapper/my_usb persistence

mkdir -p /mnt/pers

mount /dev/mapper/pers /mnt/pers

nano /mnt/pers/persistence.conf

# write the line below and save
/ union

umount /dev/mapper/pers

cryptsetup luksClose /dev/mapper/pers
```

---
#### [[6. Utilities & Pentesting Tools]]
