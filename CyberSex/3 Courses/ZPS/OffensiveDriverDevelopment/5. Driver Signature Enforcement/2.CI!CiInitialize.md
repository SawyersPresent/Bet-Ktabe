There's unfortunately no export for g_CiOptions, so we can't just lookup its location at runtime.  We have to resort to the old trick of using a known offset from something we can lookup.  To understand how and where the the option is set, we can start with the **CiInitialize** method in `ci.dll` (Code Integrity Module).

```
kd> u ci!CiInitialize
CI!CiInitialize:
fffff804`32b34130 48895c2408      mov     qword ptr [rsp+8],rbx
fffff804`32b34135 48896c2410      mov     qword ptr [rsp+10h],rbp
fffff804`32b3413a 4889742418      mov     qword ptr [rsp+18h],rsi
fffff804`32b3413f 57              push    rdi
fffff804`32b34140 4883ec20        sub     rsp,20h
fffff804`32b34144 498bd9          mov     rbx,r9
fffff804`32b34147 498bf8          mov     rdi,r8
fffff804`32b3414a 488bf2          mov     rsi,rdx
kd> u
CI!CiInitialize+0x1d:
fffff804`32b3414d 8be9            mov     ebp,ecx
fffff804`32b3414f e8b4de0700      call    CI!_security_init_cookie (fffff804`32bb2008)
fffff804`32b34154 4c8bcb          mov     r9,rbx
fffff804`32b34157 4c8bc7          mov     r8,rdi
fffff804`32b3415a 488bd6          mov     rdx,rsi
fffff804`32b3415d 8bcd            mov     ecx,ebp
fffff804`32b3415f e840090000      call    CI!CipInitialize (fffff804`32b34aa4)
fffff804`32b34164 488b5c2430      mov     rbx,qword ptr [rsp+30h]
```



The two instructions of interest is the **mov** from ebp to ecx and the **call** to CI!CipInitialize.  Looking into CipInitialize, we see the value of ecx being put into g_CiOptions.

```
kd> u CI!CipInitialize
CI!CipInitialize:
fffff804`32b34aa4 488bc4          mov     rax,rsp
fffff804`32b34aa7 48895808        mov     qword ptr [rax+8],rbx
fffff804`32b34aab 48896810        mov     qword ptr [rax+10h],rbp
fffff804`32b34aaf 48897018        mov     qword ptr [rax+18h],rsi
fffff804`32b34ab3 48897820        mov     qword ptr [rax+20h],rdi
fffff804`32b34ab7 4155            push    r13
fffff804`32b34ab9 4156            push    r14
fffff804`32b34abb 4157            push    r15
kd> u
CI!CipInitialize+0x19:
fffff804`32b34abd 4883ec40        sub     rsp,40h
fffff804`32b34ac1 498be9          mov     rbp,r9
fffff804`32b34ac4 890d4e62ffff    mov     dword ptr [CI!g_CiOptions (fffff804`32b2ad18)],ecx
kd> dw fffff804`32b2ad18 L1
fffff804`32b2ad18  000e
```



CipInitialize is not exported from ci.dll, but CiInitialize is.  Subtracting the address of g_CiOptions from CiInitialize gives **9418** in hex.  Reboot Windows a couple of times and re-check the calculation - you should get the same result each time, which gives us a known offset for this version of Windows.